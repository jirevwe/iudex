# Claude Development Context: Iudex

## Project Overview

Iudex is a JavaScript-first API testing framework with built-in governance, security checks, and PostgreSQL-backed test history.

**Location:** `/Users/rtukpe/Documents/dev/gotech/iudex`

## Related Repositories

### Examples Repository

**Location:** `/Users/rtukpe/Documents/dev/gotech/iudex-examples`
**Purpose:** Working examples of Iudex dashboard integration

The examples repo uses Iudex as a **local file dependency**:
```json
{
  "dependencies": {
    "iudex": "file:../iudex"
  }
}
```

**Workflow:** When you make changes to Iudex's dashboard server or templates, the examples repo automatically picks them up via the symlink. Test your changes by running examples:

```bash
cd ../iudex-examples
mise run express    # Test Express integration
mise run test:api   # Test API endpoints
```

## Project Structure

```
iudex/
├── cli/                    # CLI commands
├── core/                   # Core testing framework
├── reporters/              # Test reporters (console, json, postgres, github-pages)
├── server/                 # Dashboard server (NEW)
│   ├── dashboard-server.js
│   ├── handlers/          # Express, Fastify, HTTP handlers
│   └── api/               # API endpoints
├── templates/              # Dashboard templates (NEW)
│   └── dashboard/
│       ├── index.html
│       └── assets/
├── governance/             # Governance rules
├── security/              # Security checks
├── database/              # PostgreSQL integration
├── tests/                 # Unit & integration tests
├── docs/                  # Documentation
└── .iudex/results/        # Test results (for examples)
```

## Recent Additions

### Dashboard System (Week 3)

Complete dashboard implementation with:
- **Server handlers:** Express, Fastify, raw HTTP
- **Static generator:** GitHub Pages reporter
- **UI components:** Responsive dashboard with test results, governance, security
- **Examples:** Moved to separate `iudex-examples` repo

**Key files:**
- `server/dashboard-server.js` - Core server
- `server/handlers/*.js` - Framework integrations
- `templates/dashboard/` - UI templates
- `reporters/github-pages.js` - Static generator

## Dependencies

**Production:**
- `fastify-plugin` - For Fastify dashboard handler (only dashboard dep)
- Other deps for core testing framework

**Dev:**
- `@playwright/test` - Browser testing
- `@testcontainers/postgresql` - Database testing
- `jest` - Unit testing

**Note:** Express and Fastify are **NOT** dependencies of Iudex. They're in the examples repo.

## Testing

```bash
# Unit tests
npm run test:unit

# Integration tests (runs against HTTPBin)
npm run test:integration

# All tests
npm test
```

## Dashboard Development

When working on dashboard features:

1. **Edit Iudex code:** `server/`, `templates/dashboard/`, `reporters/`
2. **Test in examples repo:**
   ```bash
   cd ../iudex-examples
   mise run express
   # Visit http://localhost:3000/test-dashboard
   ```
3. **Run browser tests:**
   ```bash
   cd ../iudex-examples
   mise run test:browser
   ```

## Package Exports

```json
{
  "exports": {
    ".": "./index.js",
    "./server": "./server/index.js",
    "./server/express": "./server/handlers/express.js",
    "./server/fastify": "./server/handlers/fastify.js",
    "./server/http": "./server/handlers/http.js"
  }
}
```

## Key Integration Points

### With Examples Repo

- Examples import from `iudex/server/*`
- Examples read test data from `.iudex/results/`
- Changes to Iudex are immediately available in examples

### With PostgreSQL

- Optional database for test history
- Analytics views for flaky tests, regressions, health scores
- See `database/` and `docs/` for setup

## Common Tasks

### Add New Dashboard Feature

1. Update `server/dashboard-server.js` or handlers
2. Update `templates/dashboard/` if UI changes needed
3. Test in examples repo
4. Update `docs/DASHBOARD_SERVER.md`

### Modify Dashboard UI

1. Edit `templates/dashboard/index.html` or `assets/`
2. Restart example server
3. Test in browser
4. Take screenshots if significant changes

### Add New Reporter

1. Create file in `reporters/`
2. Export class with `report(collector)` method
3. Add to exports in `index.js`
4. Document in README and docs

### Update API Endpoints

1. Edit `server/dashboard-server.js`
2. Update `docs/DASHBOARD_API.md`
3. Test with `cd ../iudex-examples && mise run test:api`

## Quality Checks

Before committing dashboard changes:

```bash
# 1. Run tests in main repo
npm test

# 2. Test examples work
cd ../iudex-examples
mise run express &
mise run test:api

# 3. Test browser integration
mise run test:browser

# 4. Test static generation
cd ../iudex
node test-static-generator.js

# 5. Clean up
pkill -f "express-server"
```

## Documentation

- `README.md` - User-facing overview
- `docs/DASHBOARD_SERVER.md` - Dashboard setup guide
- `docs/DASHBOARD_API.md` - API reference
- `docs/GOVERNANCE.md` - Governance rules
- `docs/SECURITY.md` - Security checks
- `DASHBOARD_IMPLEMENTATION_COMPLETE.md` - Implementation summary

## Notes for Claude

### File Relationships

- **Don't copy examples back to Iudex** - They belong in `iudex-examples`
- **Don't add Express/Fastify to Iudex deps** - Only in examples repo
- **Keep server code framework-agnostic** - Core in `server/dashboard-server.js`

### Testing Dashboard

Always test changes in the examples repo:
```bash
cd ../iudex-examples
mise run express
# Open http://localhost:3000/test-dashboard
```

### Import Paths

In Iudex code: Use relative imports
```javascript
import { DashboardServer } from '../dashboard-server.js';
```

In examples code: Use package imports
```javascript
import { createExpressDashboard } from 'iudex/server/express';
```

### Test Data

Examples expect test results in `.iudex/results/`. Generate with:
```bash
npm run test:integration
```

## Current Status

- ✅ Dashboard fully implemented and tested
- ✅ All three server modes working (Express, Fastify, HTTP)
- ✅ Static generation working (GitHub Pages)
- ✅ Examples moved to separate repo
- ✅ Documentation complete
