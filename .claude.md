# Claude Development Context: Iudex

## Project Overview

Iudex is a JavaScript-first API testing framework with built-in governance, security checks, and PostgreSQL-backed test history.

**Location:** `/Users/rtukpe/Documents/dev/gotech/iudex`

## ðŸš¨ IMPORTANT: Dashboard Examples Location

**Dashboard integration examples are in a separate repository:**

```
Location: /Users/rtukpe/Documents/dev/gotech/iudex-examples
```

**DO NOT create dashboard examples in this repo.** They belong in `iudex-examples/`.

### Running Dashboard Examples

```bash
# Navigate to examples repo
cd /Users/rtukpe/Documents/dev/gotech/iudex-examples

# Using mise (recommended)
mise run express      # Express server on port 3000
mise run fastify      # Fastify server on port 3001
mise run standalone   # HTTP server on port 8080

# Using npm
npm run express
npm run fastify
npm run standalone

# Testing
mise run test:api      # Test API endpoints
mise run test:browser  # Test in headless Chrome
```

### Dashboard URLs

- Express: http://localhost:3000/test-dashboard
- Fastify: http://localhost:3001/test-dashboard
- Standalone: http://localhost:8080/

## Project Structure

```
iudex/
â”œâ”€â”€ cli/                    # CLI commands
â”œâ”€â”€ core/                   # Core testing framework
â”œâ”€â”€ examples/               # Test examples (httpbin.test.js, etc.)
â”œâ”€â”€ reporters/              # Test reporters (console, json, postgres, github-pages)
â”œâ”€â”€ server/                 # Dashboard server
â”‚   â”œâ”€â”€ dashboard-server.js
â”‚   â”œâ”€â”€ handlers/          # Express, Fastify, HTTP handlers
â”‚   â””â”€â”€ api/               # API endpoints
â”œâ”€â”€ templates/              # Dashboard templates
â”‚   â””â”€â”€ dashboard/
â”‚       â”œâ”€â”€ index.html
â”‚       â””â”€â”€ assets/
â”œâ”€â”€ governance/             # Governance rules
â”œâ”€â”€ security/              # Security checks
â”œâ”€â”€ database/              # PostgreSQL integration
â”œâ”€â”€ tests/                 # Unit tests
â””â”€â”€ docs/                  # Documentation
```

**Note:** `examples/` contains **test files** (httpbin.test.js, etc.), NOT dashboard examples. Dashboard examples are in `iudex-examples` repo.

## Related Repositories

### Examples Repository (Dashboard Integration)

**Location:** `/Users/rtukpe/Documents/dev/gotech/iudex-examples`
**Purpose:** Working examples of Iudex dashboard integration with Express, Fastify, and HTTP servers

The examples repo uses Iudex as a **local file dependency**:
```json
{
  "dependencies": {
    "iudex": "file:../iudex"
  }
}
```

**Changes to Iudex are immediately available in examples** - no manual linking needed.

## Testing

### Unit Tests

```bash
npm run test:unit
```

### Integration Tests (HTTPBin)

```bash
npm run test:integration
```

This runs tests in `examples/httpbin.test.js` and generates results in `.iudex/results/`.

### Dashboard Tests

Dashboard tests live in the examples repo:

```bash
cd ../iudex-examples
mise run test:api      # Test API endpoints
mise run test:browser  # Browser integration tests
```

## Dashboard Development Workflow

When working on dashboard features:

1. **Edit Iudex code:**
   ```bash
   # Edit server code
   vim server/dashboard-server.js
   vim server/handlers/express.js

   # Edit UI templates
   vim templates/dashboard/index.html
   vim templates/dashboard/assets/css/dashboard.css
   ```

2. **Test immediately in examples repo:**
   ```bash
   cd ../iudex-examples
   mise run express
   # Visit http://localhost:3000/test-dashboard
   ```

3. **Run automated tests:**
   ```bash
   cd ../iudex-examples
   mise run test:browser
   ```

4. **Commit changes in iudex:**
   ```bash
   cd ../iudex
   git add server/ templates/
   git commit -m "Update dashboard feature"
   ```

## Package Exports

```json
{
  "exports": {
    ".": "./index.js",
    "./server": "./server/index.js",
    "./server/express": "./server/handlers/express.js",
    "./server/fastify": "./server/handlers/fastify.js",
    "./server/http": "./server/handlers/http.js"
  }
}
```

Users import dashboard handlers like:
```javascript
import { createExpressDashboard } from 'iudex/server/express';
```

## Dependencies

**Production:**
- `fastify-plugin` - For Fastify dashboard handler (only dashboard-related dep)
- Other core testing framework dependencies

**Dev:**
- `@playwright/test` - Browser testing
- `@testcontainers/postgresql` - Database testing
- `jest` - Unit testing

**Important:** Express and Fastify are **NOT** dependencies of Iudex. They're only in `iudex-examples`.

## Common Tasks

### Generate Test Data for Dashboard

Dashboard examples need test results to display:

```bash
# Run integration tests to generate results
npm run test:integration

# Results saved to .iudex/results/
ls -la .iudex/results/
```

### Test Dashboard Changes

After modifying dashboard code:

```bash
# 1. Generate test data (if needed)
npm run test:integration

# 2. Run dashboard example
cd ../iudex-examples
mise run express &

# 3. Open browser
open http://localhost:3000/test-dashboard

# 4. Run automated tests
mise run test:browser

# 5. Clean up
pkill -f "express-server"
```

### Add Dashboard Feature

1. Edit `server/dashboard-server.js` or handlers
2. Update `templates/dashboard/` if UI changes needed
3. Test in examples repo: `cd ../iudex-examples && mise run express`
4. Update `docs/DASHBOARD_SERVER.md`
5. Commit changes in iudex repo

### Add New Test Example

Test examples stay in this repo:

1. Create file in `examples/` directory (e.g., `examples/my-api.test.js`)
2. Use Iudex testing API
3. Run with `npm run test:integration`

## Quality Checks

Before committing:

```bash
# 1. Run unit tests
npm run test:unit

# 2. Run integration tests
npm run test:integration

# 3. Test dashboard (if changed)
cd ../iudex-examples && mise run express &
cd ../iudex-examples && mise run test:browser
pkill -f "express-server"
```

## Documentation

- `README.md` - User-facing overview
- `docs/DASHBOARD_SERVER.md` - Dashboard setup guide
- `docs/DASHBOARD_API.md` - API reference
- `docs/GOVERNANCE.md` - Governance rules
- `docs/SECURITY.md` - Security checks
- `MIGRATION.md` - Examples migration info
- `DASHBOARD_IMPLEMENTATION_COMPLETE.md` - Implementation summary

## Notes for Claude

### Examples vs Dashboard Examples

- **`iudex/examples/`** = Test files (httpbin.test.js, etc.) that demonstrate testing API
- **`iudex-examples/`** = Separate repo with dashboard integration examples (Express, Fastify, HTTP)

### Important Rules

1. **Never delete test files** in `examples/` - they're valid tests, not just examples
2. **Dashboard examples belong in `iudex-examples` repo** - not here
3. **Express/Fastify are not dependencies** of main library
4. **Test data location:** `.iudex/results/` (generated by `npm run test:integration`)

### Testing Dashboard

Always test changes in the examples repo:
```bash
cd ../iudex-examples
mise run express
```

Dashboard expects test results from:
```
../iudex/.iudex/results/
```

Generate with: `cd ../iudex && npm run test:integration`

### Import Paths

**In Iudex library code:**
```javascript
import { DashboardServer } from '../dashboard-server.js';  // Relative
```

**In examples repo code:**
```javascript
import { createExpressDashboard } from 'iudex/server/express';  // Package
```

**In test files (examples/*.test.js):**
```javascript
import { describe, test, expect } from 'iudex';  // Package
```

## Current Status

- âœ… Dashboard fully implemented and tested
- âœ… All three server modes working (Express, Fastify, HTTP)
- âœ… Static generation working (GitHub Pages)
- âœ… Examples in separate repo with mise configuration
- âœ… Test files restored in examples/ directory
- âœ… Documentation complete
